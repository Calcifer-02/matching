# Matching Service

–°–µ—Ä–≤–∏—Å –¥–ª—è –º–∞—Ç—á–∏–Ω–≥–∞ –ª–∏–¥–æ–≤ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger)
FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

- **Swagger UI**: `http://localhost:8082/docs` (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ `https://your-service.onrender.com/docs`
- **ReDoc**: `http://localhost:8082/redoc`
- **OpenAPI Schema**: `http://localhost:8082/openapi.json`

–í Swagger UI –º–æ–∂–Ω–æ:
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- ‚úÖ –£–≤–∏–¥–µ—Ç—å —Å—Ö–µ–º—ã request/response
- ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ** (–∫–Ω–æ–ø–∫–∞ "Try it out")
- ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å curl –∫–æ–º–∞–Ω–¥—ã

### 1. Embedding Service (Python)
FastAPI —Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Ç–µ–∫—Å—Ç–∞:

**–ë–∞–∑–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `/embed` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- `/embed-batch` - –ø–∞–∫–µ—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- `/similarity` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–π –±–ª–∏–∑–æ—Å—Ç–∏

**–ú–∞—Ç—á–∏–Ω–≥:**
- `/match` - –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥—É
- `/match-text` - –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —Ç–µ–∫—Å—Ç—É
- `/match-weighted` - **–ù–û–í–û–ï** –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π –º–∞—Ç—á–∏–Ω–≥ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
- `/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
- `/register-vector` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞ —Å –≥–æ—Ç–æ–≤—ã–º —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–º

**–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**
- `/index/bulk` - **–ù–û–í–û–ï** –º–∞—Å—Å–æ–≤–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
- `/index/sync` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö ID
- `DELETE /index/{entity_type}` - –æ—á–∏—Å—Ç–∫–∞ –∏–Ω–¥–µ–∫—Å–∞

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `/weights/presets` - **–ù–û–í–û–ï** –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –≤–µ—Å–æ–≤

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- `/store/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- `/store/{entity_type}` - —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –∏–Ω–¥–µ–∫—Å–µ

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏:
- `sentence-transformers/all-MiniLM-L6-v2` (–ª–æ–∫–∞–ª—å–Ω–∞—è, –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è)
- `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2` (–¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞)
- OpenAI `text-embedding-3-small` (–ø–ª–∞—Ç–Ω–∞—è, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

### 2. PostgreSQL —Å pgvector
–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∏ –∏—Å–∫–∞—Ç—å –≤–µ–∫—Ç–æ—Ä—ã –≤ PostgreSQL:
- –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (`<=>`)
- L2 —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (`<->`)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (`<#>`)

### 3. Go Client
HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤—ã–∑–æ–≤–∞ Embedding API –∏–∑ Go backend.

## –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –¢–æ–ª—å–∫–æ embedding service
cd matching/embedding-service
pip install -r requirements.txt
uvicorn main:app --host 0.0.0.0 --port 8082
```

## API

### GET /health
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞.

Response:
```json
{
  "status": "healthy",
  "model": "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
  "dimensions": 384
}
```

### POST /embed
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞.

Request:
```json
{
  "text": "–ò—â—É 3-–∫–æ–º–Ω–∞—Ç–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞"
}
```

Response:
```json
{
  "embedding": [0.123, -0.456, ...],
  "model": "paraphrase-multilingual-MiniLM-L12-v2",
  "dimensions": 384
}
```

### POST /embed-batch
–ü–∞–∫–µ—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.

Request:
```json
{
  "texts": ["—Ç–µ–∫—Å—Ç 1", "—Ç–µ–∫—Å—Ç 2"]
}
```

Response:
```json
{
  "embeddings": [[0.123, ...], [0.456, ...]],
  "model": "paraphrase-multilingual-MiniLM-L12-v2",
  "dimensions": 384
}
```

### POST /similarity
–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–π –±–ª–∏–∑–æ—Å—Ç–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏.

Request:
```json
{
  "embedding1": [0.123, -0.456, ...],
  "embedding2": [0.789, 0.012, ...]
}
```

Response:
```json
{
  "similarity": 0.85
}
```

### POST /register
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —ç–º–±–µ–¥–¥–∏–Ω–≥–∞.

Request:
```json
{
  "entity_id": "lead-123",
  "entity_type": "leads",
  "text": "–ò—â—É 3-–∫–æ–º–Ω–∞—Ç–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞",
  "metadata": {
    "budget_min": 5000000,
    "budget_max": 8000000,
    "city": "–ú–æ—Å–∫–≤–∞"
  }
}
```

Response:
```json
{
  "success": true,
  "entity_id": "lead-123",
  "entity_type": "leads"
}
```

### POST /register-vector
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞ —Å –≥–æ—Ç–æ–≤—ã–º —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–º.

Request:
```json
{
  "entity_id": "property-456",
  "entity_type": "properties",
  "embedding": [0.123, -0.456, ...],
  "metadata": {
    "price": 6500000,
    "rooms": 3,
    "city": "–ú–æ—Å–∫–≤–∞"
  }
}
```

### DELETE /register
–£–¥–∞–ª–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

Request:
```json
{
  "entity_id": "lead-123",
  "entity_type": "leads"
}
```

### POST /match
–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥—É.

Request:
```json
{
  "embedding": [0.123, -0.456, ...],
  "entity_type": "properties",
  "top_k": 5,
  "min_similarity": 0.5
}
```

Response:
```json
{
  "matches": [
    {
      "entity_id": "property-456",
      "similarity": 0.92,
      "metadata": {
        "price": 6500000,
        "rooms": 3,
        "city": "–ú–æ—Å–∫–≤–∞"
      }
    },
    {
      "entity_id": "property-789",
      "similarity": 0.78,
      "metadata": {...}
    }
  ],
  "total_searched": 150
}
```

### POST /match-text
–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —Ç–µ–∫—Å—Ç—É (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

Request:
```json
{
  "text": "–ò—â—É 3-–∫–æ–º–Ω–∞—Ç–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞",
  "entity_type": "properties",
  "top_k": 5,
  "min_similarity": 0.5
}
```

Response: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `/match`

### GET /store/stats
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤.

Response:
```json
{
  "leads_count": 42,
  "properties_count": 150,
  "total_count": 192
}
```

### GET /store/{entity_type}
–°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞.

Response:
```json
{
  "entity_type": "leads",
  "count": 42,
  "entities": [
    {
      "entity_id": "lead-123",
      "metadata": {...},
      "embedding_dimensions": 384
    }
  ]
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π –º–∞—Ç—á–∏–Ω–≥–∞ –ª–∏–¥–∞ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

1. –ë—ç–∫–µ–Ω–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:
```bash
curl -X POST http://localhost:8082/register \
  -H "Content-Type: application/json" \
  -d '{
    "entity_id": "property-1",
    "entity_type": "properties",
    "text": "3-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã, 85 –∫–≤.–º, –µ–≤—Ä–æ—Ä–µ–º–æ–Ω—Ç",
    "metadata": {"price": 12000000, "rooms": 3}
  }'
```

2. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª–∏–¥–∞ –¥–µ–ª–∞–µ–º –º–∞—Ç—á–∏–Ω–≥:
```bash
curl -X POST http://localhost:8082/match-text \
  -H "Content-Type: application/json" \
  -d '{
    "text": "–ò—â—É –ø—Ä–æ—Å—Ç–æ—Ä–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã",
    "entity_type": "properties",
    "top_k": 10,
    "min_similarity": 0.6
  }'
```

---

## –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: –í–∑–≤–µ—à–µ–Ω–Ω—ã–π –º–∞—Ç—á–∏–Ω–≥

### POST /match-weighted
**–í–∑–≤–µ—à–µ–Ω–Ω—ã–π –º–∞—Ç—á–∏–Ω–≥ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.**

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å:
- –í–µ—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (—Ü–µ–Ω–∞, —Ä–∞–π–æ–Ω, –∫–æ–º–Ω–∞—Ç—ã, –ø–ª–æ—â–∞–¥—å, —Å–µ–º–∞–Ω—Ç–∏–∫–∞)
- –ñ—ë—Å—Ç–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (–æ–±—ä–µ–∫—Ç—ã –Ω–µ –ø—Ä–æ—à–µ–¥—à–∏–µ ‚Äî –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é)
- –ú—è–≥–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ (–≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–æ –Ω–µ –∏—Å–∫–ª—é—á–∞—é—Ç)

Request:
```json
{
  "text": "–ò—â—É 2-–∫–æ–º–Ω–∞—Ç–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ü–µ–Ω—Ç—Ä–µ –¥–æ 10 –º–ª–Ω",
  "entity_type": "properties",
  "top_k": 10,
  "weights": {
    "price": 0.35,
    "district": 0.30,
    "rooms": 0.20,
    "area": 0.05,
    "semantic": 0.10
  },
  "hard_filters": {
    "price": {
      "min_price": null,
      "max_price": 12000000
    },
    "districts": ["–¶–µ–Ω—Ç—Ä", "–ê—Ä–±–∞—Ç", "–¢–≤–µ—Ä—Å–∫–æ–π"],
    "rooms": [1, 2, 3],
    "min_area": 40,
    "max_area": 100
  },
  "soft_criteria": {
    "target_price": 10000000,
    "target_rooms": 2,
    "target_district": "–¶–µ–Ω—Ç—Ä",
    "target_area": 55,
    "preferred_districts": ["–¶–µ–Ω—Ç—Ä", "–ê—Ä–±–∞—Ç"]
  },
  "min_total_score": 0.5
}
```

Response:
```json
{
  "matches": [
    {
      "entity_id": "prop-2",
      "total_score": 0.9197,
      "price_score": 0.925,
      "district_score": 1.0,
      "rooms_score": 1.0,
      "area_score": 0.5,
      "semantic_score": 0.7867,
      "metadata": {
        "price": 9500000,
        "district": "–¶–µ–Ω—Ç—Ä",
        "rooms": 2,
        "area": 55
      },
      "match_explanation": "—Ü–µ–Ω–∞ 9,500,000‚ÇΩ –≤ –±—é–¥–∂–µ—Ç–µ; —Ä–∞–π–æ–Ω '–¶–µ–Ω—Ç—Ä' –ø–æ–¥—Ö–æ–¥–∏—Ç; 2-–∫–æ–º–Ω. –∫–∞–∫ –Ω—É–∂–Ω–æ"
    }
  ],
  "total_searched": 7,
  "filtered_out": 2,
  "weights_used": {
    "price": 0.35,
    "district": 0.30,
    "rooms": 0.20,
    "area": 0.05,
    "semantic": 0.10
  }
}
```

### GET /weights/presets
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –≤–µ—Å–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

Response:
```json
{
  "balanced": {
    "name": "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
    "description": "–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤",
    "weights": {"price": 0.25, "district": 0.25, "rooms": 0.20, "area": 0.15, "semantic": 0.15}
  },
  "budget_first": {
    "name": "–ë—é–¥–∂–µ—Ç –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ",
    "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±—é–¥–∂–µ—Ç—É",
    "weights": {"price": 0.45, "district": 0.20, "rooms": 0.15, "area": 0.10, "semantic": 0.10}
  },
  "location_first": {
    "name": "–õ–æ–∫–∞—Ü–∏—è –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ",
    "description": "–†–∞–π–æ–Ω –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ - –≥–ª–∞–≤–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç",
    "weights": {"price": 0.20, "district": 0.40, "rooms": 0.15, "area": 0.10, "semantic": 0.15}
  },
  "family": {
    "name": "–î–ª—è —Å–µ–º—å–∏",
    "description": "–í–∞–∂–Ω—ã –∫–æ–º–Ω–∞—Ç—ã –∏ –ø–ª–æ—â–∞–¥—å",
    "weights": {"price": 0.20, "district": 0.20, "rooms": 0.30, "area": 0.20, "semantic": 0.10}
  },
  "semantic_heavy": {
    "name": "–£–º–Ω—ã–π –ø–æ–∏—Å–∫",
    "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞",
    "weights": {"price": 0.15, "district": 0.15, "rooms": 0.15, "area": 0.10, "semantic": 0.45}
  }
}
```

---

## –ú–∞—Å—Å–æ–≤–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

### POST /index/bulk
–ú–∞—Å—Å–æ–≤–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ —á–µ–º –ø–æ –æ–¥–Ω–æ–º—É).

Request:
```json
{
  "entity_type": "properties",
  "items": [
    {
      "entity_id": "prop-1",
      "text": "3-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ, 80–º¬≤",
      "metadata": {"price": 15000000, "district": "–¶–µ–Ω—Ç—Ä", "rooms": 3, "area": 80}
    },
    {
      "entity_id": "prop-2",
      "text": "2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ —É –º–µ—Ç—Ä–æ, 55–º¬≤",
      "metadata": {"price": 9500000, "district": "–¶–µ–Ω—Ç—Ä", "rooms": 2, "area": 55}
    }
  ],
  "clear_existing": false
}
```

Response:
```json
{
  "total": 2,
  "indexed": 2,
  "failed": 0,
  "results": [
    {"entity_id": "prop-1", "success": true, "error": null},
    {"entity_id": "prop-2", "success": true, "error": null}
  ]
}
```

### DELETE /index/{entity_type}
–û—á–∏—Å—Ç–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞.

```bash
curl -X DELETE http://localhost:8082/index/properties
```

Response:
```json
{
  "message": "Cleared 150 properties from index",
  "deleted_count": 150
}
```

### POST /index/sync
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ ID –≤ –∏–Ω–¥–µ–∫—Å–µ (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –ë–î).

Response:
```json
{
  "leads": ["lead-1", "lead-2", "lead-3"],
  "properties": ["prop-1", "prop-2"]
}
```

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ò–µ—Ä–∞—Ä—Ö–∏—è –≤–∞–∂–Ω–æ—Å—Ç–∏ (–æ—Ç—Ä–∞—Å–ª–µ–≤–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏):

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|-----|----------|
| üî¥ 1 | –¶–µ–Ω–∞/–ë—é–¥–∂–µ—Ç | –ñ—ë—Å—Ç–∫–∏–π —Ñ–∏–ª—å—Ç—Ä | –ï—Å–ª–∏ –Ω–µ –≤ –±—é–¥–∂–µ—Ç–µ ‚Äî –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è |
| üî¥ 2 | –†–∞–π–æ–Ω/–õ–æ–∫–∞—Ü–∏—è | –ñ—ë—Å—Ç–∫–∏–π —Ñ–∏–ª—å—Ç—Ä | –ï—Å–ª–∏ –Ω–µ –≤ –Ω—É–∂–Ω–æ–º —Ä–∞–π–æ–Ω–µ ‚Äî –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è |
| üü° 3 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç | –ú—è–≥–∫–∏–π | ¬±1 –∫–æ–º–Ω–∞—Ç–∞ = —Å–Ω–∏–∂–µ–Ω–∏–µ score |
| üü° 4 | –ü–ª–æ—â–∞–¥—å | –ú—è–≥–∫–∏–π | ¬±15% = –Ω–µ–±–æ–ª—å—à–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ |
| üü¢ 5 | –°–µ–º–∞–Ω—Ç–∏–∫–∞ | –ú—è–≥–∫–∏–π | –î–ª—è –¥–æ–ø. –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (–ø–∞—Ä–∫, —à–∫–æ–ª–∞, –º–µ—Ç—Ä–æ) |

### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ score:

```
total_score = w_price √ó price_score + 
              w_district √ó district_score + 
              w_rooms √ó rooms_score + 
              w_area √ó area_score + 
              w_semantic √ó semantic_score
```

–ì–¥–µ –≤—Å–µ –≤–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è —Ç–∞–∫, —á—Ç–æ–±—ã –∏—Ö —Å—É–º–º–∞ = 1.

### –†–∞—Å—á—ë—Ç score –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:

**Price score:**
- –í –ø—Ä–µ–¥–µ–ª–∞—Ö ¬±20% –æ—Ç —Ü–µ–ª–µ–≤–æ–π —Ü–µ–Ω—ã: 1.0 ‚Üí 0.7 (–ª–∏–Ω–µ–π–Ω–æ)
- –ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –¥–æ–ø—É—Å–∫–∞: –±—ã—Å—Ç—Ä–æ –ø–∞–¥–∞–µ—Ç –¥–æ 0

**District score:**
- –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 1.0
- –í —Å–ø–∏—Å–∫–µ preferred: 0.7
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 0.6
- –ù–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç: 0.3

**Rooms score:**
- –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 1.0
- ¬±1 –∫–æ–º–Ω–∞—Ç–∞: 0.6
- ¬±2 –∫–æ–º–Ω–∞—Ç—ã: 0.3
- –ë–æ–ª—å—à–µ: 0.1

**Area score:**
- –í –ø—Ä–µ–¥–µ–ª–∞—Ö ¬±15%: 1.0 ‚Üí 0.7
- –ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏: –ø–∞–¥–∞–µ—Ç

**Semantic score:**
- –ö–æ—Å–∏–Ω—É—Å–Ω–∞—è –±–ª–∏–∑–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (0-1)


