# Changelog

## [2.2.0] - 2024-12-20 - Model Upgrade & Critical Fixes

### üî• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ù–æ–≤–∞—è –º–æ–¥–µ–ª—å: `ai-forever/ru-en-RoSBERTa`**
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
   - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 768 (–≤–º–µ—Å—Ç–æ 384)
   - –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è semantic matching

2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**
   ```python
   model.encode(
       texts,
       batch_size=32,
       normalize_embeddings=True,  # –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è cosine similarity!
       ...
   )
   ```
   - pgvector + cosine (`<=>`) –æ–∂–∏–¥–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã
   - –ë–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ similarity "–ø–ª—ã–≤—ë—Ç" –∏ —Ö—É–∂–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫—ç—à-–ª–æ–≥–∏–∫–∞**
   - –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `encode_single_async_with_flag()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `(embedding, cached)`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–≤–æ–π–Ω—ã–µ `CACHE_MISSES`
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–ª–∞–≥ `cached` –≤–æ –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–∞—Ö

4. **MAX_CONCURRENT_REQUESTS = 6** (–±—ã–ª–æ 4)
   - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è 8-16 vCPU

### ‚ö†Ô∏è Breaking Changes

- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å: 384 ‚Üí 768**
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã!
- SQL –º–∏–≥—Ä–∞—Ü–∏—è:
  ```sql
  ALTER TABLE leads DROP COLUMN embedding;
  ALTER TABLE leads ADD COLUMN embedding vector(768);
  -- –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å
  CREATE INDEX ON leads USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);
  ```

---

## [2.1.0] - 2024-12-19 - Production-Ready Release

### üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è production-ready —Å—Ç–∞—Ç—É—Å–∞ –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º —ç–∫—Å–ø–µ—Ä—Ç–æ–≤.

---

## –ß—Ç–æ –±—ã–ª–æ (v2.0.0) vs –ß—Ç–æ —Å—Ç–∞–ª–æ (v2.1.0)

### 1. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ CPU/IO —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

**–ë—ã–ª–æ:**
```python
# –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤, –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop FastAPI
embedding = model.encode(request.text, convert_to_numpy=True)
```

**–°—Ç–∞–ª–æ:**
```python
# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ ThreadPoolExecutor
async def encode_async(texts: List[str]) -> np.ndarray:
    loop = asyncio.get_event_loop()
    result = await asyncio.wait_for(
        loop.run_in_executor(
            executor,
            lambda: model.encode(texts, convert_to_numpy=True, show_progress_bar=False)
        ),
        timeout=ENCODE_TIMEOUT_SECONDS
    )
    return result
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ –°–µ—Ä–≤–∏—Å –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚úÖ –¢–∞–π–º–∞—É—Ç 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–∑–∞–≤–∏—Å–∞–Ω–∏–µ" –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –î–æ 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö encode –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MAX_CONCURRENT_REQUESTS`)

---

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ë—ã–ª–æ:**
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å DoS-–∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ –æ–≥—Ä–æ–º–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–°—Ç–∞–ª–æ:**
```python
MAX_BATCH_SIZE = 128          # –ú–∞–∫—Å–∏–º—É–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –±–∞—Ç—á–µ
MAX_TEXT_LENGTH = 10000       # –ú–∞–∫—Å–∏–º—É–º —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ
MAX_CONCURRENT_REQUESTS = 4   # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ encode –æ–ø–µ—Ä–∞—Ü–∏–∏
ENCODE_TIMEOUT_SECONDS = 30   # –¢–∞–π–º–∞—É—Ç –Ω–∞ encode

class EmbedRequest(BaseModel):
    text: str = Field(..., min_length=1, max_length=MAX_TEXT_LENGTH)

class BatchRequest(BaseModel):
    items: List[BatchItem] = Field(..., max_length=MAX_BATCH_SIZE)
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –±–æ–ª—å—à–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ 400 –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

---

### 3. Prometheus –º–µ—Ç—Ä–∏–∫–∏

**–ë—ã–ª–æ:**
- –ù–µ—Ç –º–µ—Ç—Ä–∏–∫
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- "–°–ª–µ–ø–æ–π –ø–æ–ª—ë—Ç" –≤ production

**–°—Ç–∞–ª–æ:**
```python
# Endpoint /metrics –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
embedding_requests_total{endpoint="/embed", status="success"} 150
embedding_request_latency_seconds_bucket{endpoint="/embed", le="0.1"} 120
embedding_batch_size_bucket{le="10"} 45
embedding_encode_failures_total{reason="timeout"} 2
embedding_model_loaded 1
embedding_cache_hits_total 89
embedding_cache_misses_total 61
embedding_active_requests 3
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Grafana: requests/s, latency, batch sizes
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –Ω–∞ encode_failures –∏ model_loaded
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ cache hit rate –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

### 4. Rate Limiting

**–ë—ã–ª–æ:**
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –æ–¥–Ω–∏–º –∫–ª–∏–µ–Ω—Ç–æ–º

**–°—Ç–∞–ª–æ:**
```python
RATE_LIMIT = "100/minute"       # –î–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
RATE_LIMIT_BATCH = "20/minute"  # –î–ª—è –±–∞—Ç—á–µ–π

@app.post("/embed")
@limiter.limit(RATE_LIMIT)
async def embed_text(request: Request, body: EmbedRequest):
    ...
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
- ‚úÖ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- ‚úÖ HTTP 429 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

---

### 5. In-Memory –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ë—ã–ª–æ:**
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–Ω–æ–≤–æ
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–∞—Ç—è—Ç CPU

**–°—Ç–∞–ª–æ:**
```python
CACHE_ENABLED = True
CACHE_TTL_SECONDS = 3600    # 1 —á–∞—Å
CACHE_MAX_SIZE = 10000      # 10k —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
cache_key = hashlib.sha256(text.encode()).hexdigest()
if cache_key in embedding_cache:
    return embedding_cache[cache_key]  # –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ!
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ **–î–æ 100x —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (0.1-0.5s ‚Üí <1ms)
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è CPU –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ TTL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫—ç—à
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: `GET /cache/stats`, –æ—á–∏—Å—Ç–∫–∞: `POST /cache/clear`

---

### 6. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏

**–ë—ã–ª–æ:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å
- –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏

**–°—Ç–∞–ª–æ:**
```python
# –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
{
    "embedding": [...],
    "model_version": "2.1.0",
    "model_checksum": "a1b2c3d4e5f6"  # MD5 –æ—Ç model_name:dimensions
}
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ Go Backend –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å model_checksum –≤–º–µ—Å—Ç–µ —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–º
- ‚úÖ –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏
- ‚úÖ `/model-info` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏

---

### 7. Structured Logging (JSON)

**–ë—ã–ª–æ:**
```
Loading embedding model: sentence-transformers/...
Model loaded. Dimensions: 384
```

**–°—Ç–∞–ª–æ:**
```json
{"event": "model_loading", "model": "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2", "timestamp": "2024-12-19T10:30:00Z"}
{"event": "model_loaded", "dimensions": 384, "checksum": "a1b2c3d4e5f6", "load_time_seconds": 12.5, "timestamp": "2024-12-19T10:30:12Z"}
{"event": "batch_process", "total": 50, "successful": 50, "cached": 12, "timestamp": "2024-12-19T10:35:00Z"}
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ELK/Loki/CloudWatch
- ‚úÖ –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
- ‚úÖ –¢—Ä–µ–π—Å–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤

---

### 8. –£–ª—É—á—à–µ–Ω–Ω–∞—è –±–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞

**–ë—ã–ª–æ:**
```python
# –í—Å–µ —Ç–µ–∫—Å—Ç—ã –≥–µ–Ω–µ—ÄÔøΩÔøΩ—Ä—É—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ
embeddings = model.encode(texts, convert_to_numpy=True)
```

**–°—Ç–∞–ª–æ:**
```python
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
for item in body.items:
    cache_key = get_cache_key(prepared)
    if cache_key in embedding_cache:
        # –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –∫—ç—à–∞!
        cached_count += 1
        continue
    texts_to_encode.append(prepared)

# –¢–æ–ª—å–∫–æ –Ω–µ–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–¥—É—Ç –≤ model.encode
if texts_to_encode:
    embeddings = await encode_async(texts_to_encode)
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ –°–º–µ—à–∞–Ω–Ω—ã–π –±–∞—Ç—á (–∫—ç—à + compute) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
- ‚úÖ –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç `cached_count` –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –ö–∞–∂–¥—ã–π `BatchResultItem` –∏–º–µ–µ—Ç —Ñ–ª–∞–≥ `cached: true/false`

---

### 9. Graceful Error Handling

**–ë—ã–ª–æ:**
- 500 –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
- –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–∏—á–∏–Ω–µ

**–°—Ç–∞–ª–æ:**
```python
# –¢–∞–π–º–∞—É—Ç
except asyncio.TimeoutError:
    ENCODE_FAILURES.labels(reason="timeout").inc()
    raise HTTPException(status_code=503, detail=f"Encoding timeout after {ENCODE_TIMEOUT_SECONDS}s")

# –û—à–∏–±–∫–∞ –º–æ–¥–µ–ª–∏
except Exception as e:
    ENCODE_FAILURES.labels(reason="error").inc()
    raise HTTPException(status_code=500, detail=f"Encoding error: {str(e)}")
```

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
- ‚úÖ 503 –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º (–∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å)
- ‚úÖ 400 –¥–ª—è –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å)
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏

---

### 10. –ù–æ–≤—ã–µ endpoints

| Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `GET /metrics` | Prometheus –º–µ—Ç—Ä–∏–∫–∏ |
| `GET /cache/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞ |
| `POST /cache/clear` | –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ |

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `EMBEDDING_MODEL` | `paraphrase-multilingual-MiniLM-L12-v2` | –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ |
| `MAX_BATCH_SIZE` | `128` | –ú–∞–∫—Å–∏–º—É–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –±–∞—Ç—á–µ |
| `MAX_TEXT_LENGTH` | `10000` | –ú–∞–∫—Å–∏–º—É–º —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ |
| `MAX_CONCURRENT_REQUESTS` | `4` | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ encode |
| `ENCODE_TIMEOUT_SECONDS` | `30` | –¢–∞–π–º–∞—É—Ç –Ω–∞ encode |
| `RATE_LIMIT` | `100/minute` | Rate limit –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö |
| `RATE_LIMIT_BATCH` | `20/minute` | Rate limit –¥–ª—è –±–∞—Ç—á–µ–π |
| `CACHE_ENABLED` | `true` | –í–∫–ª—é—á–∏—Ç—å –∫—ç—à |
| `CACHE_TTL_SECONDS` | `3600` | TTL –∫—ç—à–∞ (1 —á–∞—Å) |
| `CACHE_MAX_SIZE` | `10000` | –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ |
| `ALLOWED_ORIGINS` | `*` | CORS origins |

---

## –û—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

| –ö—Ä–∏—Ç–µ—Ä–∏–π | v2.0.0 | v2.1.0 |
|----------|--------|--------|
| –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å | ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç event loop | ‚úÖ ThreadPoolExecutor |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | ‚ùå –ù–µ—Ç –ª–∏–º–∏—Ç–æ–≤ | ‚úÖ Batch/text limits |
| –ú–µ—Ç—Ä–∏–∫–∏ | ‚ùå –ù–µ—Ç | ‚úÖ Prometheus |
| Rate limiting | ‚ùå –ù–µ—Ç | ‚úÖ slowapi |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå –ù–µ—Ç | ‚úÖ TTLCache |
| –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå –ù–µ—Ç | ‚úÖ checksum –≤ –æ—Ç–≤–µ—Ç–∞—Ö |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå print() | ‚úÖ structlog JSON |
| –¢–∞–π–º–∞—É—Ç—ã | ‚ùå –ù–µ—Ç | ‚úÖ 30s timeout |
| Error handling | ‚ùå –ë–∞–∑–æ–≤—ã–π | ‚úÖ Graceful 503/400 |

**–†–µ–π—Ç–∏–Ω–≥:** 5/10 ‚Üí **8/10** ‚úÖ

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (roadmap –¥–ª—è 9/10)

1. **Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫—ç—à–∞
2. **OpenTelemetry tracing** ‚Äî trace_id propagation
3. **API Key –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ (`API_KEY` env)
4. **Background workers** ‚Äî –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö reindex-batch (Celery/RQ)
5. **ONNX Runtime** ‚Äî –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
6. **Health check —Å warmup** ‚Äî pre-load model weights

---

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å v2.0.0

1. –û–±–Ω–æ–≤–∏—Ç—å `requirements.txt`
2. –û–±–Ω–æ–≤–∏—Ç—å `main.py`
3. –û–±–Ω–æ–≤–∏—Ç—å `Dockerfile` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus scraping –Ω–∞ `/metrics`
5. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Breaking changes:** –ù–µ—Ç. –í—Å–µ endpoints —Å–æ–≤–º–µ—Å—Ç–∏–º—ã.

